name: Convert Gallery Images to JPEG

on:
  workflow_dispatch:
  push:
    branches:
      - fix/gallery-image-format
    paths:
      - 'scripts/convert-images.sh'
      - 'public/images/gallery*.png'

permissions:
  contents: write

jobs:
  convert:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
      - name: ðŸ“¥ Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          
      - name: ðŸ› ï¸ Install ImageMagick
        run: |
          echo "ðŸ“¦ Installing ImageMagick..."
          sudo apt-get update -qq
          sudo apt-get install -y -qq imagemagick
          echo "âœ… ImageMagick installed"
          convert -version
          
      - name: ðŸŽ¨ Convert PNG to JPEG
        run: |
          chmod +x scripts/convert-images.sh
          bash scripts/convert-images.sh
          
      - name: ðŸ“Š Show converted files
        run: |
          echo "ðŸ“ Converted files:"
          ls -lh public/images/gallery*.jpeg || echo "No JPEG files found"
          echo ""
          echo "ðŸ“Š Size comparison:"
          echo "PNG files:"
          ls -lh public/images/gallery2.png public/images/gallery3.png 2>/dev/null || echo "No PNG files"
          echo ""
          echo "JPEG files:"
          ls -lh public/images/gallery2.jpeg public/images/gallery3.jpeg 2>/dev/null || echo "No JPEG files"
          
      - name: ðŸ’¾ Commit converted images
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          
          if [ -f "public/images/gallery2.jpeg" ] || [ -f "public/images/gallery3.jpeg" ]; then
            git add public/images/gallery*.jpeg
            git commit -m "feat: add converted JPEG gallery images
            
            - Converted gallery2.png to gallery2.jpeg
            - Converted gallery3.png to gallery3.jpeg
            - Optimized to 85% quality
            - Reduced file sizes for better performance"
            
            echo "âœ… Changes committed"
          else
            echo "âš ï¸  No JPEG files to commit"
            exit 1
          fi
          
      - name: ðŸš€ Push changes
        run: |
          git push
          echo "âœ… JPEG images pushed to repository"
          
      - name: ðŸ“¢ Summary
        run: |
          echo "## âœ¨ Image Conversion Complete!" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Converted Files" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… gallery2.jpeg" >> $GITHUB_STEP_SUMMARY
          echo "- âœ… gallery3.jpeg" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Next Steps" >> $GITHUB_STEP_SUMMARY
          echo "1. Create Pull Request" >> $GITHUB_STEP_SUMMARY
          echo "2. Merge to main" >> $GITHUB_STEP_SUMMARY
          echo "3. Images will appear in gallery" >> $GITHUB_STEP_SUMMARY
